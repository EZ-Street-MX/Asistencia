<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia Empleados</title>
<style>
body{font-family:Arial;background:#0b1220;color:#fff;margin:0;padding:20px}
.card{max-width:520px;margin:auto;background:#111a2e;padding:20px;border-radius:10px}
button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:6px;background:#1f3b6d;color:#fff;font-size:16px}
input{width:100%;padding:10px;margin-top:10px;border-radius:6px;border:none}
.msg{margin-bottom:10px;color:#f88}
</style>
</head>
<body>

<div class="card" id="login">
  <h2>Control de Asistencia</h2>
  <div class="msg" id="msg"></div>
  <input id="user" placeholder="Código o ADMIN">
  <input id="pin" type="password" placeholder="PIN">
  <button onclick="login()">Entrar</button>
</div>

<div class="card" id="panel" style="display:none">
  <h3 id="empName"></h3>
  <button onclick="mark('Entrada')">Marcar Entrada</button>
  <button onclick="mark('Salida')">Marcar Salida</button>
  <button onclick="logout()">Salir</button>
</div>

<script>
if(!localStorage.adminPin) localStorage.adminPin="9999";
if(!localStorage.employees){
  localStorage.employees=JSON.stringify([{code:"1001",name:"Juan Pérez",pin:"1111"}]);
}
if(!localStorage.records) localStorage.records="[]";

let current=null;

function login(){
  const u=user.value.trim(), p=pin.value.trim();
  if(u==="ADMIN" && p===localStorage.adminPin){
    alert("Admin OK");
    return;
  }
  const emps=JSON.parse(localStorage.employees);
  const e=emps.find(x=>x.code===u && x.pin===p);
  if(!e){msg.innerText="Datos incorrectos";return;}
  current=e;
  document.getElementById("login").style.display="none";
  document.getElementById("panel").style.display="block";
  document.getElementById("empName").innerText=e.name;
}

function mark(type){
  if(!navigator.geolocation){
    save(type,null);
    return;
  }
  navigator.geolocation.getCurrentPosition(
    pos=>save(type,pos),
    err=>save(type,null),
    {enableHighAccuracy:true,timeout:5000}
  );
}

function save(type,pos){
  const recs=JSON.parse(localStorage.records);
  recs.push({
    empleado:current.name,
    codigo:current.code,
    tipo:type,
    fecha:new Date().toISOString(),
    lat:pos?pos.coords.latitude:null,
    lng:pos?pos.coords.longitude:null,
    precision:pos?pos.coords.accuracy:null
  });
  localStorage.records=JSON.stringify(recs);
  alert(type+" registrada");
}

function logout(){location.reload();}
</script>

</body>
</html>
